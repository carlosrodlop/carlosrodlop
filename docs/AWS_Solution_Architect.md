# References

* https://codingnconcepts.com/aws/aws-certified-solutions-architect-associate/#aws-infrastructure
* https://digitalcloud.training/aws-cheat-sheets/
* https://chloemcateer.medium.com/aws-solution-architect-associate-exam-study-notes-b6c5884ee500

# AWS Solution Architect

## Infrastructure

### AWS Region

* AWS regions are physical locations around the world having cluster of data centers
* You need to select the region first for most of the AWS services such as EC2, ELB, S3, Lambda, etc.
* You can not select region for Global AWS services such as IAM, AWS Organizations, Route 53, CloudFront, WAF, etc.
* Each AWS Region consists of multiple, isolated, and physically separate AZs (Availability Zones) within a geographic area.

### AWS AZ (Availability zones)

* An AZ is one or more discrete data centers with redundant power, networking, and connectivity
* All AZs in an AWS Region are interconnected with high-bandwidth, low-latency networking.
Customer deploy applications across multiple AZs in same region for high-availability, scalability, fault-tolerant and low-latency.
*  AZs in a region are usually 3, min is 2 and max is 6 for e.g. 3 AZs in Ohio are us-east-2a, us-east-2b, and us-east-2c.
* For high availability in us-east-2 region with min 6 instances required either place 3 instances in each 3 AZs or place 6 instances in each 2 AZs (choose any 2 AZs out of 3) so that it works normal when 1 AZ goes down.

## Security, Identity & Compliance

### IAM (Global Service)

* AWS Identity and Access Management Service (AWS IAM) is used to securely control **individual and group access to AWS resources**.
* IAM is global (so region isn’t a factor)
* It offers centralized control over your AWS account. It enables shared access to your AWS account.
* Granular Permissions (can set different permissions for different people/ different resources)
* Can enable identity federation
* Allows you to set up custom password policies (including rotation policies)
* IAM Terminology
  * `Users` mapped to the physical user, should log in to AWS console with their account and password.
    * IAM users are individuals who have been granted access to an AWS account. By default, they do NO have access to any AWS services (they can only login to the AWS console) ==> Permission must be explicitly granted to allow a user to access an AWS service.
    * Each IAM user has three main components: A username + A password + Permissions to access various resources
  * `Groups` can have one or more users, and can not have other groups. Groups allow you to define permissions for all the users within it.
  * `Root account` is created by default with full administrator.
    * It is a best practice to not use the root account for anything other than billing. You should put MFA onto your root account.
  * `Power user access` → Access to all AWS services except the management of groups and users within IAM
  * `Roles` are associated with trusted entities - AWS services (EC2, Lambda, etc), Another AWS account, Web Identity (Cognito or any OpenID provider), or SAML 2.0 federation (your corporate directory). You attach policy to the role, these entities assume the role to access the AWS resources.
    * Roles are more secure than sharing access and secret keys.
    * * Identity Federation (including AD, Facebook etc). can be configured to allow secure access to resources in an AWS account without creating an IAM user account. Non-IAM user first authenticates from Identity Federation. Then provide a temporary token (IAM Role attached) generated by calling a AssumeRole API of `STS (Security Token Service)`. Non-IAM user access the AWS resource by **assuming IAM Role attached with token**.
  * `Policies` determine what a user, group or role can or cannot do. 
    * They are JSON documents that `Allow` or `Deny` access to an action that can be performed on AWS resources by any user, group and role.
    * Each statement matches an AWS API request
    * Anything that is not explicitly allowed is implicitly denied
      * **IAM Policy Evaluation Logic** ➔ Explicit Deny ➯ Organization SCPs ➯ Resource-based Policies (optional) ➯ IAM Permission Boundaries ➯ Identity-based Policies
    * If a resource has multiple policies — AWS joins them
    * The **Least Privilege Principle** should be followed in AWS, don’t give more permission than a user needs.
    * **IAM Permission Boundaries** to set at individual user or role for maximum allowed permissions
    * **Resource Based Policies** are supported by S3, SNS, and SQS. 
    * Sections:
      * `Version` policy language version. `2012-10-17` is the latest version.
      * `Statement` container for one or more policy statements
      * `Sid` (optional) a way of labeling your policy statement
      * `Effect` set whether the policy Allows or Deny
      * `Principal` user, group, role, or federated user to which you would like to allow or deny access
      * `Action` one or more actions that can be performed on AWS resources
      * `Resource` one or more AWS resources to which actions apply
      * `Condition` (optional) one or more conditions to satisfy for policy to be applicable, otherwise ignore the policy.
  
```json
{
    "Version":"2012-10-17",
    "Statement":[{
        "Sid": "Deny-Barclay-S3-Access",
        "Effect":"Deny",
        "Principal": { "AWS": ["arn:aws:iam:123456789012:barclay"] },
        "Action": [ "s3:GetObject", "s3:PutObject", "s3:List*" ],
        "Resource": ["arn:aws:s3:::mybucket/*"]
    },{
        "Effect": "Allow",
        "Action": "iam:CreateServiceLinkedRole",
        "Resource": "*",
        "Condition": {
            "StringLike": {
                "iam:AWSServiceName": [
                    "rds.amazonaws.com",
                    "rds.application-autoscaling.amazonaws.com"
                ]
            }
        }
    }]
}
```

* If you got SSL/TLS certificates from third-party CA, import the certificate into AWS Certificate Manager (ACM) or upload it to the IAM Certificate Store

#### Access AWS for IAM Users

* Options:
  * AWS Management Console - Use password + MFA (multi factor authentication)
  * AWS CLI or SDK - Use Access Key ID (~username) and Secret Access Key (~password)
  * AWS CloudShell - CLI tool from AWS browser console - Require login to AWS

Temporary security credentials consist of the AWS access key ID, secret access key, and security token.
    * IAM can assign temporary security credentials to provide users with temporary access to services/resources.

### Amazon Cognito

* Cognito User Pools (CUP)
  * User Pools is a **user directory** for sign-up and sign-in to mobile and web applications.
  * User pool is mainly used for **authentication** to access AWS services
  * Use to **authenticate** mobile app users through **user pool directory**, or federated through third-party identity provider (IdP). The user pool manages the overhead of handling the tokens that are returned from social sign-in through Facebook, Google, Amazon, and Apple, and from OpenID Connect (OIDC) and SAML IdPs.
  After successful authentication, your web or mobile app will receive user pool JWT tokens from Amazon Cognito. JWT token can be used in two ways:
      * You use JWT tokens to retrieve temporary AWS credentials that allow your app to access other AWS services.
      * You create group in user pool with IAM role to access API Gateway, then you can use JWT token (for that group) to access Amazon API Gateway.

* Cognito Identity Pools (Federated Identity)
  * Identity pool is mainly used for authorization to access AWS services
  * You first authenticate user using `User Pools` and then exchange token with `Identity Pools` which further use `AWS STS` to generate temporary AWS credentials to access AWS Resources.
  * You can provide temporary access to write to S3 bucket using facebook/google login to your mobile app users.
  * Supports guest users

### AWS Key Management Service (KMS)

* AWS managed centralized key management service to create, manage and rotate customer master keys (CMKs) for encryption at REST. Provides you with a central place to manage all keys.
* Can integrate with most other AWS services to increase security and make it easier to encrypt your data.
* You can enable automatic master key rotation once per year. Service keeps the older version of master key to decrypt old encrypted data.
* Allows you to control access to the keys using things like IAM policies or key policies.
* Encrypt/decrypt up to 4KB.
* Pay per API call.
* Validated under FIPS 140–2 (Level 2 ) security standard.
* Types of Customer Master Keys (CMKs)
  * `Customer Managed CMKs` → Keys that you have created in AWS, that you own and manage. You are responsible for managing their key policies, rotating them and enabling/disabling them.
    * You can create customer-managed `Symmetric` (single key for both encrypt and decrypt operations) or `Asymmetric` (public/private key pair for encrypt/decrypt or sign/verify operations) master keys
    * Symmetric CMKs
      * With symmetric keys, the same key is used to encrypt and decrypt
      * The key never leaves AWS unencrypted
      * Must call the KMS API to use a symmetric key
      * The AWS services that integrate with KMS use symmetric CMKs
    * Asymmetric CMKs
      * Asymmetric keys are mathematically related public and private key pairs.
      * The private key never leaves AWS unencrypted.
      * You can call the KMS API with the public key, which can be downloaded and used outside of AWS.
      * AWS services that integrate with KMS DO NOT support asymmetric keys.
  * `AWS Managed CMKs` → These are free and are created by an AWS service on your behalf and are managed for you. However, only that service can use them.
  * `AWS Owned CMKs` → owned and managed by AWS and shared across many accounts.

### AWS CloudHSM

* Dedicated cloud-based Hardware Security Module (HSM) for creating, using and managing your own encryption keys (cryptographic keys) in AWS.
* Conforms to FIPS 140–2 (level 3) security standard
* No access to the AWS managed component and AWS does not have visibility or access to your keys.
* Integrate with your application using industry-standard APIs, such as PKCS#11, Java Cryptography Extensions (JCE), and Microsoft CryptoNG (CNG) libraries (there are no AWS APIs for HSM)
* CloudHSM runs within a VPC in your account
* Keys are irretrievable if lost and can not be recovered.
* Use case: Use KMS to create a CMKs in a custom key store and store non-extractable key material in AWS CloudHSM to get a full control on encryption keys

### AWS Systems Manager

* `Parameter Store` is centralized secrets and configuration data management e.g. passwords, database details, and license code
    * `Parameter` value can be type String (plain text), StringList (comma separated) or SecureString (KMS encrypted data)
    * `Use case`: Centralized configuration for dev/uat/prod environment to be used by CLI, SDK, and Lambda function
* `Run Command` allows you to automate common administrative tasks and perform one-time configuration changes on EC2 instances at scale
* `Session Manager` replaces the need for Bastions to access instances in private subnet

### AWS Secrets Manager

* Secret Manager is mainly used to store, manage, and rotate secrets (passwords) such as database credentials, API keys, and OAuth tokens.
* Secret Manager has **native support to rotate database credentials of RDS databases** - MySQL, PostgreSQL and Amazon Aurora
* For other secrets such as API keys or tokens, you need to use the **lambda for customized rotation function**

### AWS Shield

* AWS managed **Distributed Denial of Service (DDoS) protection service**
* Protect against **Layer 3 and 4** (Network and Transport) attacks
* `AWS Shield Standard` is automatic and free DDoS protection service for all AWS customers for CloudFront and Route 53 resources
* `AWS Shield Advanced` is paid service for enhanced DDoS protection for EC2, ELB, CloudFront, and Route 53 resources


### AWS WAF

* **Web Application Firewall** add an extra layer of protection to your web applications or APIs against web attacks from common exploits, such as SQL injection or Cross-site scripting (XSS).
* Protect against **Layer 7** (HTTP & HTTPS) attacks and block common attack patterns by setting up rules to control the traffic. How?
  * Setting up your own rules to control the traffic by either only allowing what you specify or only blocking what you specify. Alternatively, you can count the requests that match a certain pattern.
  * AWS also provides managed rules that you can use to get started quickly, these are fully pre-configured and cover things like the OWASP Top 10 Security risks.
  * Conditions are used in WAFs to specify when you want to allow/block requests. Below are some examples of conditions that you might:
    * Values on the request header
    * The country a request comes from
    * Specific IP addresses
    * Strings that appear in requests
    * Length of the request
    * Presence of SQL code
    * Presence of a script
* You can deploy WAF on CloudFront, Application Load Balancer, API Gateway and AWS AppSync
* Pay for what you use, based on the number of rules you have and requests your applications receive.

### AWS Firewall Manager

* Use AWS Firewall Manager to centrally configure and manage AWS WAF rules, AWS Shield Advanced, Network Firewall rules, and Route 53 DNS Firewall Rules across accounts and resources in AWS Organization
* Use case: Meet Gov regulations to deploy AWS WAF rule to block traffic from embargoed countries across accounts and resources

### AWS GuardDuty

* Read VPC Flow Logs, DNS Logs, and CloudTrail events. Apply machine learning algorithms and anomaly detections to discover threats
* Can protect against CryptoCurrency attacks

### Amazon Inspector

* Automated Security Assessment service for **EC2 instances** by installing an agent in the OS of EC2 instance.
* Inspector comes with pre-defined rules packages:
  * `Network Reachability` rules package checks for unintended network accessibility of EC2 instances
  * `Host Assessment rules` package checks for vulnerabilities and insecure configurations on EC2 instance. Includes Common Vulnerabilities and Exposures (CVE), Center for Internet Security (CIS) Operating System configuration benchmarks, and security best practices.

### Amazon Macie

* Managed service to discover and protect your **sensitive data** in AWS
* Macie identity and alert for sensitive data, such as **Personally Identifiable Information (PII)** in your selected S3 buckets

### AWS Config

* Managed service to assess, audit, and evaluate configurations of your AWS resources in multi-region, multi-account
* You are notified via SNS for any configuration change
* Integrated with CloudTrail, provide resource configuration history
* Use case: Customers need to comply with standards like PCI-DSS (Payment Card Industry Data Security Standard) or HIPAA (U.S. Health Insurance Portability and Accountability Act) can use this service to assess compliance of AWS infra configurations

## Compute

### EC2

## Autoscaling

bla

## AWS Organization and Control Tower


## VPC


## S3


## DNS, Catching and Performance

## Block and File Storage

## Docker Container and ECS

## Serveless Applications


## Databases y Analytics

## Deployment and Management

## Monitoring, Loggin and Auditing

## Security in the Cloud

## Migration and Trasnfer

## Web, Mobile, ML and Cost Managemnt



