# References

* https://digitalcloud.training/aws-cheat-sheets/
* https://codingnconcepts.com/aws/aws-certified-solutions-architect-associate/#aws-infrastructure
* https://github.com/kasukur/AWS_CCP_Notes/blob/main/AWS_Solution_Architecture_Associate.txt
* http://clusterfrak.com/notes/certs/aws_saa_notes/
* https://chloemcateer.medium.com/aws-solution-architect-associate-exam-study-notes-b6c5884ee500

# AWS Solution Architect

## Global

### Infrastructure

* [30 Regions with 96 Availability Zones](http://clusterfrak.com/notes/certs/aws_saa_notes/#security-and-identity)
* Edge locations are CDN endpoints for CloudFront. Currently there are over 50 edge locations. Not the same as an AZ
* Maximum Response time for Business is 1 hour
* Services such as CloudFormation, Elastic Beanstalk, Autoscaling, and OpsWorks are free however resources generated by these services are not free

#### AWS Region

* AWS regions are physical locations around the world having cluster of data centers
* You need to select the region first for most of the AWS services such as EC2, ELB, S3, Lambda, etc.
* You can not select region for Global AWS services such as IAM, AWS Organizations, Route 53, CloudFront, WAF, etc.
* Each AWS Region consists of multiple, isolated, and physically separate AZs (Availability Zones) within a geographic area.

#### AWS AZ (Availability zones)

* An AZ is one or more discrete data centers with redundant power, networking, and connectivity
* All AZs in an AWS Region are interconnected with high-bandwidth, low-latency networking.
* Customer deploy applications across multiple AZs in same region for high-availability, scalability, fault-tolerant and low-latency.
* AZs in a region are usually 3, min is 2 and max is 6 for e.g. 3 AZs in Ohio are us-east-2a, us-east-2b, and us-east-2c.
* For high availability in us-east-2 region with min 6 instances required either place 3 instances in each 3 AZs or place 6 instances in each 2 AZs (choose any 2 AZs out of 3) so that it works normal when 1 AZ goes down.

### Tags

* Key/Value pairs attached to AWS resources
* Metadata (data about data). 
* Sometimes can be inherited (Auto-scaling, CloudFormation, Elastic Beanstalk can create other resources)
* Resource Groups make it easy to group your resources using the tags that are assigned to them
  * You can group resources that share one or more tags
  * Resource groups contain info such as region, name, health checks

### Amazon Resource Name (ARN)

* Identifier (ID) for any AWS resource. They are globally unique
* begin with `arn:<partition>:<service>:<region>:<account_id>` and end with: resource
resource_type/resource, resource_type/resource/qualifier, resource_type/resource:qualifier, resource_type:resource and resource_type:resource:qualifier
* Examples:
	* `arn:aws:iam::123456789012:user/sri` <-- :: region is omitted because IAM is global
  * `arn:aws:s3:::my_awesome_bucket/image.png` <-- ::: - no region, no account id needed to identify an object in S3. all objects in S3 are globally unique
  * `arn:aws:dynamodb:us-east-1:123456789012:table/orders`
  * `arn:aws:ec2:us-east-1:123456789012:instance/*` - wildcard. EC2 is a regional service

### Consolidated Billing:

* Accounts roll for customers:
  * Paying account is independent, can not access resources of the other accounts
  * Linked accounts are independent from one another
  * Currently there is a limit of 20 linked accounts for consolidated billing (soft limit)
  * One bill per AWS account
  * Easy to track charges and allocate costs between linked accounts
  * Volume pricing discount
  * Resources across all linked accounts are tallied, and billing is applied collectively to allow bigger discounts

### Best Practices:

* Business Benefits of Cloud:
  * Almost 0 upfront infrastructure investment
  * Just in time Infrastructure
  * More efficient resource utilization
  * Usage based costing
  * Reduced time to market

* Technical Benefits of Cloud:
  * Automation - Scriptable infrastructure
  * Auto-Scaling
  * Proactive Scaling
  * More efficient development life cycle
  * Improved testability
  * DR and Business Continuity
  * Overflow the traffic to the cloud

* Design for Failure
  * Rule of thumb: Be a pessimist when designing architectures in the cloud
  * Assume things will fail, always design implement and deploy for automated recovery from failure
  * Assume your hardware will fail
  * Assume outages will occur
  * Assume that some disaster will strike your application
  * Assume that you will be slammed with more than the expected number of requests per second
  * Assume that with time your application software will fail too

* Decouple your components:
  * Think SQS
  * Build components that do not have tight dependencies on each other so that if one component dies, fails, sleeps, or becomes busy, the other components are built so they can continue to work as if no failure is happening. Build each component as a black box

### [Service Quotas](https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html) (known before as Service Limits)

* Your AWS account has default quotas, formerly referred to as limits, for each AWS service. Unless otherwise noted, each quota is Region-specific. You can request increases for some quotas, and other quotas cannot be increased.

## Security, Identity & Compliance

### IAM (Global Service)

* AWS Identity and Access Management Service (AWS IAM) is used to securely control **individual and group access to AWS resources**.
* IAM is global (so region isn’t a factor)
* It offers centralized control over your AWS account. It enables shared access to your AWS account.
* Granular Permissions (can set different permissions for different people/ different resources)
* Includes Federation Integration which taps into Active Directory, Facebook, Linkedin, etc. for authentication
* Multi-factor authentication support
* Allows configuration of temporary access for users, devices and services
* It supports PCI DSS compliance. PCI DSS compliance just is basically a compliant framework that if you're taking credit card details, you need to be compliant with the framework. So IAM supports PCI DSS.
* Access entities:
  * `Users` End users such as people, employees of an organisation ... etc
    * IAM users are individuals who have been granted access to an AWS account.
    * New Users
      * They have NO permissions when first created, NO have access to any AWS services (they can only login to the AWS console) ==> Permission must be explicitly granted to allow a user to access an AWS service.
      * They are assigned Access Key ID & Secret Access Keys when first created => You can get to view these once. If you lose them, you have to regenerate them.
      * In order for a new IAM user to be able to log into the console, the user must have a password set 
  * `Groups` are a collection of users, and can not have other groups. Groups allow you to define permissions for all the users within it.
  * `Roles` Assigned to AWS resources, specifying what the resource (such as EC2) is allowed to access on another resource (S3)
    * Adventanges
      * Roles are more secure than storing your access key and secret access key on individual EC2 instances.
      * Roles are easier to manage.
      * Roles can be assigned to an EC2 instance after it is created using both the console & command line.
    * Types of Roles
      * Service Roles (To assign permission to AWS Resources)
      * Cross account access roles: Used when you have multiple AWS accounts and another AWS account must interact with the current AWS account
      * Identity provider access roles : Identity Federation (including AD, Facebook etc) can be configured to allow secure access to resources in an AWS account without creating an IAM user account.

* `Policies` JSON Document that defines permissions (`Allow` or `Deny` access to an action that can be performed on AWS resources) for Access Entities (user, group or role) 
    * Each statement matches an AWS API request
    * Anything that is not explicitly allowed is implicitly denied
      * **IAM Policy Evaluation Logic** ➔ Explicit Deny ➯ Organization SCPs ➯ Resource-based Policies (optional) ➯ IAM Permission Boundaries ➯ Identity-based Policies
    * If a resource has multiple policies — AWS joins them
    * The **Least Privilege Principle** should be followed in AWS, don’t give more permission than a user needs.
    * **IAM Permission Boundaries** to set at individual user or role for maximum allowed permissions
    * **Resource Based Policies** are supported by S3, SNS, and SQS. 
    * Sections:
      * `Version` policy language version. `2012-10-17` is the latest version.
      * `Statement` container for one or more policy statements
      * `Sid` (optional) a way of labeling your policy statement
      * `Effect` set whether the policy Allows or Deny
      * `Principal` user, group, role, or federated user to which you would like to allow or deny access
      * `Action` one or more actions that can be performed on AWS resources
      * `Resource` one or more AWS resources to which actions apply
      * `Condition` (optional) one or more conditions to satisfy for policy to be applicable, otherwise ignore the policy.
  
```json
{
    "Version":"2012-10-17",
    "Statement":[{
        "Sid": "Deny-Barclay-S3-Access",
        "Effect":"Deny",
        "Principal": { "AWS": ["arn:aws:iam:123456789012:barclay"] },
        "Action": [ "s3:GetObject", "s3:PutObject", "s3:List*" ],
        "Resource": ["arn:aws:s3:::mybucket/*"]
    },{
        "Effect": "Allow",
        "Action": "iam:CreateServiceLinkedRole",
        "Resource": "*",
        "Condition": {
            "StringLike": {
                "iam:AWSServiceName": [
                    "rds.amazonaws.com",
                    "rds.application-autoscaling.amazonaws.com"
                ]
            }
        }
    }]
}
```

* `Root account` is created by default with full administrator. Root account is email address that you used to register your account
  * Best practices 
    * Not to use the root account for anything other than billing (not login)
    * Always setup Multifactor Authentication on your root account.
* `Power user access` → Access to all AWS services except the management of groups and users within IAM

### Access AWS

#### IAM Users

* Options:
  * AWS Management Console - Use password + MFA (multi factor authentication)
  * AWS CLI or SDK - Use Access Key ID (~username) and Secret Access Key (~password)
  * AWS CloudShell - CLI tool from AWS browser console - Require login to AWS

* Temporary security credentials consist of the AWS access key ID, secret access key, and security token.
    * IAM can assign temporary security credentials to provide users with temporary access to services/resources.

* When creating a user's credentials, you can only see/download the credentials at the time of creation not after.
* Access Keys can be retired, and new ones can be created in the event that secret access keys are lost
* To create a user password, once the users have been created, choose the user you want to set the password for and from the User Actions drop list, click manage password. Here you can opt to create a generated or custom password. If generated, there is an option to force the user to set a custom password on next login. Once a generated password has been issued, you can see the password which is the same as the access keys. Its shown once only

#### None IAM Users

* Non-IAM user first authenticates from Identity Federation ==> Then provide a temporary token (IAM Role attached) generated by calling a AssumeRole API of `STS (Security Token Service)` ==> Non-IAM user access the AWS resource by **assuming IAM Role attached with token**.

##### Identity Federation

* SAML 2.0 (old) to integrate Active Directory/ADFS, use AssumeRoleWithSAML STS API
* Custom Identity Broker used when identity provider is not compatible to SAML 2.0, use AssumeRole or GetFederationToken STS API
* Web Identity Federation is used to sign in using well-known external identity provider (IdP), such as login with Amazon, Facebook, Google, or any OpenID Connect (OIDC)-compatible IdP. Get the ID token from IdP, use AWS Cognito api to exchange ID token with cognito token, use AssumeRoleWithWebIdentity STS API to get temp security credential to access AWS resources
* AWS Cognito (`Cognito Identity Pools`) is recommended identity provider by Amazon
   * You first authenticate user using `Cognito User Pools` and then exchange token with `Cognito Identity Pools` which further use `AWS STS` to generate temporary AWS credentials to access AWS Resources.
   * You can provide temporary access to write to S3 bucket using facebook/google login to your mobile app users.
  * Supports guest users
* Amazon Single Sign On gives single sign on token to access AWS, no need to call STS API
##### AWS Directory Service

* Directories store information about users, groups, and devices, and administrators use them to manage access to information and resources. Hierarchical database of users, groups, computers - trees and forests.

###### AWS Directory Service for Microsoft Active Directory 

*  AWS Managed Microsoft AD is managed Microsoft Windows Server AD with trust connection to on-premise Microsoft AD. Best choice when you need all AD features to support AWS applications or Windows workloads. can be used for single sign-on for windows workloads.
* Types
  * Use AD Connector is proxy service to redirect requests to on-premise Microsoft AD. Best choice to use existing on-premise AD with compatible AWS services.
  * Use Simple AD  is standalone AWS managed compatible AD powered by Samba 4 with basic directory features. You cannot connect it to on-premise AD. Best choice for basic directory features.

###### Amazon Cognito (Cognito User Pools (CUP))

* User Pools is a **user directory** for sign-up and sign-in to mobile and web applications.
* Use to **authenticate** mobile app users through **user pool directory**, or federated through third-party identity provider (IdP). The user pool manages the overhead of handling the tokens that are returned from social sign-in through Facebook, Google, Amazon, and Apple, and from OpenID Connect (OIDC) and SAML IdPs.

### AWS Key Management Service (KMS)

* AWS managed centralized key management service to create, manage and rotate customer master keys (CMKs) for encryption at REST. Provides you with a central place to manage all keys.
* Can integrate with most other AWS services to increase security and make it easier to encrypt your data.
* You can enable automatic master key rotation once per year. Service keeps the older version of master key to decrypt old encrypted data.
* Allows you to control access to the keys using things like IAM policies or key policies.
* Encrypt/decrypt up to 4KB.
* Pay per API call.
* Validated under FIPS 140–2 (**Level 2**) security standard.
* Types of Customer Master Keys (CMKs)
  * `Customer Managed CMKs` (Dedicated to my account) → Keys that you have created in AWS, that you own and manage. You are responsible for managing their key policies, rotating them and enabling/disabling them.
    * You can create customer-managed `Symmetric` (single key for both encrypt and decrypt operations) or `Asymmetric` (public/private key pair for encrypt/decrypt or sign/verify operations) master keys
    * Symmetric CMKs
      * With symmetric keys, the same key is used to encrypt and decrypt
      * The key never leaves AWS unencrypted
      * Must call the KMS API to use a symmetric key
      * The AWS services that integrate with KMS use symmetric CMKs
    * Asymmetric CMKs
      * Asymmetric keys are mathematically related public and private key pairs.
      * The private key never leaves AWS unencrypted.
      * You can call the KMS API with the public key, which can be downloaded and used outside of AWS.
      * AWS services that integrate with KMS DO NOT support asymmetric keys.
  * `AWS Managed CMKs` (Dedicated to my account) → These are free and are created by an AWS service on your behalf and are managed for you. However, only that service can use them. Used by default if you pick encryption in most AWS services
  * `AWS Owned CMKs` (No Dedicated to my account) → owned and managed by AWS and shared across many accounts.

### AWS CloudHSM

* Dedicated cloud-based Hardware Security Module (HSM) for creating, using and managing your own encryption keys (cryptographic keys) in AWS.
* Conforms to FIPS 140–2 (**Level 3**) security standard
* No access to the AWS managed component and AWS does not have visibility or access to your keys.
* Integrate with your application using industry-standard APIs (No AWS APIs), such as PKCS#11, Java Cryptography Extensions (JCE), and Microsoft CryptoNG (CNG) libraries (there are no AWS APIs for HSM)
* CloudHSM runs within a VPC in your account
  *  CloudHSM will operate inside its own VPC dedicated to CloudHSM
  *  CloudHSM will project to ENI of customer VPC
* Keys are irretrievable if lost and can not be recovered.
* Use case: Use KMS to create a CMKs in a custom key store and store non-extractable key material in AWS CloudHSM to get a full control on encryption keys
* Difference between KMS and CloudHSM 
  * FIPS 140–2 Level 2 vs Level 3
  * We manage our keys
	* KMS (Multi Tenant) and CloudHSM (Single Tenant, dedicate h/w, Mutli-AZ cluster)

### AWS Systems Manager

* `Parameter Store` is Secure and centralized serverless storage of configuration and secrets: passwords, database details, and license code, API Keys
    * `Parameter` value can be type String (plain text), StringList (comma separated) or SecureString (KMS encrypted data)
    * `Use case`: Centralized configuration for dev/uat/prod environment to be used by CLI, SDK, and Lambda function
* `Run Command` allows you to automate common administrative tasks and perform one-time configuration changes on EC2 instances at scale
* `Session Manager` replaces the need for Bastions to access instances in private subnet

### AWS Secrets Manager

* Secret Manager is mainly used to store, manage, and rotate secrets (passwords) such as database credentials, API keys, and OAuth tokens. 
* Apply the new key/passwords in RDS for you. Generate random secrets.
* Secret Manager has **native support to rotate database credentials of RDS databases** - MySQL, PostgreSQL and Amazon Aurora. Automatically rotate secrets.
* For other secrets such as API keys or tokens, you need to use the **lambda for customized rotation function**.

### AWS Shield

* AWS managed **Distributed Denial of Service (DDoS) protection service**.
* Protect against **Layer 3 and 4** (Network and Transport) attacks.
* `AWS Shield Standard` is automatic and free DDoS protection service for all AWS customers for CloudFront and Route 53 resources.
* `AWS Shield Advanced` is paid service (Advanced costs $3K per month per org) for enhanced DDoS protection for EC2, ELB, CloudFront, and Route 53 resources.

### AWS WAF

* **Web Application Firewall** add an extra layer of protection to your web applications or APIs against web attacks from common exploits, such as SQL injection or Cross-site scripting (XSS).
* You can deploy WAF on CloudFront, Application Load Balancer, API Gateway and AWS AppSync
* Protect against **Layer 7** (HTTP & HTTPS) attacks and block common attack patterns by setting up rules to control the traffic. How?
  * Setting up your own rules to control the traffic by either only allowing what you specify or only blocking what you specify. Alternatively, you can count the requests that match a certain pattern.
  * AWS also provides managed rules that you can use to get started quickly, these are fully pre-configured and cover things like the OWASP Top 10 Security risks.
  * Conditions are used in WAFs to specify when you want to allow/block requests. Below are some examples of conditions that you might:
    * Values on the request header
    * The country a request comes from
    * Specific IP addresses
    * Strings that appear in requests
    * Length of the request
    * Presence of SQL code
    * Presence of a script
* Pay for what you use, based on the number of rules you have and requests your applications receive.

### AWS Firewall Manager

* Use AWS Firewall Manager to centrally configure and manage Firewall Rules across an Organization: AWS WAF rules, AWS Shield Advanced, Network Firewall rules, and Route 53 DNS Firewall Rules 
* Use case: Meet Gov regulations to deploy AWS WAF rule to block traffic from embargoed countries across accounts and resources

### AWS GuardDuty

* Read VPC Flow Logs, DNS Logs, and CloudTrail events. Apply machine learning algorithms and anomaly detections to discover threats
* Can protect against CryptoCurrency attacks

### Amazon Inspector

* Automated Security Assessment service for **EC2 instances** by installing an agent in the OS of EC2 instance.
* Inspector comes with pre-defined rules packages:
  * `Network Reachability` rules package checks for unintended network accessibility of EC2 instances
  * `Host Assessment rules` package checks for vulnerabilities and insecure configurations on EC2 instance. Includes Common Vulnerabilities and Exposures (CVE), Center for Internet Security (CIS) Operating System configuration benchmarks, and security best practices.

### Amazon Macie

* Managed service to discover and protect your **sensitive data** in AWS
* Can automatically discover **Personally Identifiable Information (PII)**  in your data and can alert you once identified (e.g. selected S3 buckets) 
* Can produce dashboards, reporting and alerts
* Benefits of Macie
  * Cost efficiently discovers sensitive data at scale
  * Constant visibility of data security/privacy through alerts and dashboards
  * Can use used across AWS accounts through AWS Organisations.
  * Can help you meet regulatory compliance
  * Great for PCI-DSS(credit card payments) and preventing theft

### AWS Config

* Managed service that provides you with an AWS resource inventory, configuration history, and configuration change notifications to enable security and governance. Assess, audit, and evaluate configurations of your AWS resources in multi-region, multi-account
* You are notified via SNS for any configuration change
* Integrated with CloudTrail, provide resource configuration history
* Use case: Customers need to comply with standards like PCI-DSS (Payment Card Industry Data Security Standard) or HIPAA (U.S. Health Insurance Portability and Accountability Act) can use this service to assess compliance of AWS infra configurations

## Compute

### EC2

## Autoscaling

## AWS Organization and Control Tower


## VPC


## S3


## DNS, Catching and Performance

## Block and File Storage

## Docker Container and ECS

## Serveless Applications


## Databases y Analytics

## Deployment and Management

## Monitoring, Loggin and Auditing

## Security in the Cloud

## Migration and Trasnfer

## Web, Mobile, ML and Cost Managemnt



