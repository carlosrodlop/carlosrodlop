# References

* https://codingnconcepts.com/aws/aws-certified-solutions-architect-associate/#aws-infrastructure
* https://digitalcloud.training/aws-cheat-sheets/

# AWS Solution Architect

## Infrastructure

### AWS Region

* AWS regions are physical locations around the world having cluster of data centers
* You need to select the region first for most of the AWS services such as EC2, ELB, S3, Lambda, etc.
* You can not select region for Global AWS services such as IAM, AWS Organizations, Route 53, CloudFront, WAF, etc.
* Each AWS Region consists of multiple, isolated, and physically separate AZs (Availability Zones) within a geographic area.

### AWS AZ (Availability zones)

* An AZ is one or more discrete data centers with redundant power, networking, and connectivity
* All AZs in an AWS Region are interconnected with high-bandwidth, low-latency networking.
Customer deploy applications across multiple AZs in same region for high-availability, scalability, fault-tolerant and low-latency.
*  AZs in a region are usually 3, min is 2 and max is 6 for e.g. 3 AZs in Ohio are us-east-2a, us-east-2b, and us-east-2c.
* For high availability in us-east-2 region with min 6 instances required either place 3 instances in each 3 AZs or place 6 instances in each 2 AZs (choose any 2 AZs out of 3) so that it works normal when 1 AZ goes down.

## Security, Identity & Compliance

### IAM (Global Service)

* IAM is used to manage access to users and resources
* IAM is a global service (applied to all the regions at the same time). IAM is free service.
* `Root account` is created by default with full administrator, shouldn’t be used
* `Users` mapped to physical user, should log in to AWS console with their own account and password
* `Groups` can have one or more users, and can not have other groups
* `Policies` are JSON documents that `Allow` or `Deny` the access on action can be performed on AWS resource by any user, group and role
    * `Version` policy language version. `2012-10-17` is latest version.
    * `Statement` container for one or more policy statements
    * `Sid` (optional) a way of labeling your policy statement
    *  `Effect` set whether the policy Allow or Deny
     * `Principal` user, group, role, or federated user to which you would like to allow or deny access
    * `Action` one or more actions that can be performed on AWS resources
    * `Resource` one or more AWS resource to which actions apply
    * `Condition` (optional) one or more conditions to satisfy for policy to be applicable, otherwise ignore the policy

```json
{
    "Version":"2012-10-17",
    "Statement":[{
        "Sid": "Deny-Barclay-S3-Access",
        "Effect":"Deny",
        "Principal": { "AWS": ["arn:aws:iam:123456789012:barclay"] },
        "Action": [ "s3:GetObject", "s3:PutObject", "s3:List*" ],
        "Resource": ["arn:aws:s3:::mybucket/*"]
    },{
        "Effect": "Allow",
        "Action": "iam:CreateServiceLinkedRole",
        "Resource": "*",
        "Condition": {
            "StringLike": {
                "iam:AWSServiceName": [
                    "rds.amazonaws.com",
                    "rds.application-autoscaling.amazonaws.com"
                ]
            }
        }
    }]
}
```

* `Roles` are associated with trusted entities - AWS services (EC2, Lambda, etc), Another AWS account, Web Identity (Cognito or any OpenID provider), or SAML 2.0 federation (your corporate directory). You attach policy to the role, these entities assume the role to access the AWS resources.
* `Least Privilege Principle` should be followed in AWS, don’t give more permission than a user needs.
* `Resource Based Policies` are supported by S3, SNS, and SQS
* `IAM Permission Boundaries` to set at individual user or role for maximum allowed permissions
* `IAM Policy Evaluation Logic` ➔ Explicit Deny ➯ Organization SCPs ➯ Resource-based Policies (optional) ➯ IAM Permission Boundaries ➯ Identity-based Policies
* If you got SSL/TLS certificates from third-party CA, import the certificate into AWS Certificate Manager (ACM) or upload it to the IAM Certificate Store

### Access AWS programmatically

* Options:
  * AWS Management Console - Use password + MFA (multi factor authentication)
  * AWS CLI or SDK - Use Access Key ID (~username) and Secret Access Key (~password)
  * AWS CloudShell - CLI tool from AWS browser console - Require login to AWS

### Access AWS for Non-IAM users

* Non-IAM user first authenticate from Identity Federation. Then provide a temporary token (IAM Role attached) generated by calling a AssumeRole API of `STS (Security Token Service)`. Non-IAM user access the AWS resource by **assuming IAM Role attached with token**.
* You can authenticate and authorize Non-IAM users using the following Identity Federation:-
    * `SAML 2.0` (old) to integrate Active Directory/ADFS, use AssumeRoleWithSAML STS API
    * `Custom Identity Broker` used when identity provider is not compatible to SAML 2.0, use AssumeRole or GetFederationToken STS API
    * `Web Identity Federation` is used to sign in using well-known external identity provider (IdP), such as login with Amazon, Facebook,  Google, or any OpenID Connect (OIDC)-compatible IdP. Get the ID token from IdP, use AWS Cognito api to exchange ID token with cognito token, use AssumeRoleWithWebIdentity STS API to get temp security credential to access AWS resources
    * `AWS Cognito` is recommended identity provider by Amazon
    * `Amazon Single Sign On` gives single sign on token to access AWS, no need to call STS API
* You can use `AWS Directory Service` to manage Active Directory (AD) in AWS for e.g.
    * `AWS Managed Microsoft AD` is managed Microsoft Windows Server AD with trust connection to on-premise Microsoft AD. Best choice when you need all AD features to support AWS applications or Windows workloads. can be used for single sign-on for windows workloads.
    * `AD Connector` is proxy service to redirect requests to on-premise Microsoft AD. Best choice to use existing on-premise AD with compatible AWS services.
    * `Simple AD` is standalone AWS managed compatible AD powered by Samba 4 with basic directory features. You cannot connect it to on-premise AD. Best choice for basic directory features.
    * `Amazon Cognito` is a user directory for sign-up and sign-in to mobile and web application using Cognito User Pools. Nothing to do with Microsoft AD.

### Amazon Cognito

* Cognito User Pools (CUP)
  * User Pools is a **user directory** for sign-up and sign-in to mobile and web applications.
  * User pool is mainly used for **authentication** to access AWS services
  * Use to **authenticate** mobile app users through **user pool directory**, or federated through third-party identity provider (IdP). The user pool manages the overhead of handling the tokens that are returned from social sign-in through Facebook, Google, Amazon, and Apple, and from OpenID Connect (OIDC) and SAML IdPs.
  After successful authentication, your web or mobile app will receive user pool JWT tokens from Amazon Cognito. JWT token can be used in two ways:
      * You use JWT tokens to retrieve temporary AWS credentials that allow your app to access other AWS services.
      * You create group in user pool with IAM role to access API Gateway, then you can use JWT token (for that group) to access Amazon API Gateway.

* Cognito Identity Pools (Federated Identity)
  * Identity pool is mainly used for authorization to access AWS services
  * You first authenticate user using `User Pools` and then exchange token with `Identity Pools` which further use `AWS STS` to generate temporary AWS credentials to access AWS Resources.
  * You can provide temporary access to write to S3 bucket using facebook/google login to your mobile app users.
  * Supports guest users


### AWS Key Management Service (KMS)

* AWS managed centralized key management service to create, manage and rotate customer master keys (CMKs) for encryption at rest.
* You can create customer-managed `Symmetric` (single key for both encrypt and decrypt operations) or `Asymmetric` (public/private key pair for encrypt/decrypt or sign/verify operations) master keys
* You can enable automatic master key rotation once per year. Service keeps the older version of master key to decrypt old encrypted data.


### AWS CloudHSM

* AWS managed dedicated hardware security model (HSM) in AWS Cloud
* Enables you to securely generate, store, and manage your own cryptographic keys
* Integrate with your application using industry-standard APIs, such as PKCS#11, Java Cryptography Extensions (JCE), and Microsoft CryptoNG (CNG) libraries.
* Use case: Use KMS to create a CMKs in a custom key store and store non-extractable key material in AWS CloudHSM to get a full control on encryption keys

### AWS Systems Manager

* `Parameter Store` is centralized secrets and configuration data management e.g. passwords, database details, and license code
    * `Parameter` value can be type String (plain text), StringList (comma separated) or SecureString (KMS encrypted data)
    * `Use case`: Centralized configuration for dev/uat/prod environment to be used by CLI, SDK, and Lambda function
* `Run Command` allows you to automate common administrative tasks and perform one-time configuration changes on EC2 instances at scale
* `Session Manager` replaces the need for Bastions to access instances in private subnet

### AWS Secrets Manager

* Secret Manager is mainly used to store, manage, and rotate secrets (passwords) such as database credentials, API keys, and OAuth tokens.
* Secret Manager has **native support to rotate database credentials of RDS databases** - MySQL, PostgreSQL and Amazon Aurora
* For other secrets such as API keys or tokens, you need to use the **lambda for customized rotation function**

### AWS Shield

* AWS managed **Distributed Denial of Service (DDoS) protection service**
* Protect against **Layer 3 and 4** (Network and Transport) attacks
* `AWS Shield Standard` is automatic and free DDoS protection service for all AWS customers for CloudFront and Route 53 resources
* `AWS Shield Advanced` is paid service for enhanced DDoS protection for EC2, ELB, CloudFront, and Route 53 resources


### AWS WAF

* **Web Application Firewall** protects web applications against common web exploits
* Protect against **Layer 7** (HTTP) attack and block common attack patterns, such as SQL injection or Cross-site scripting (XSS)
* You can deploy WAF on CloudFront, Application Load Balancer, API Gateway and AWS AppSync

### AWS Firewall Manager

* Use AWS Firewall Manager to centrally configure and manage AWS WAF rules, AWS Shield Advanced, Network Firewall rules, and Route 53 DNS Firewall Rules across accounts and resources in AWS Organization
* Use case: Meet Gov regulations to deploy AWS WAF rule to block traffic from embargoed countries across accounts and resources

### AWS GuardDuty

* Read VPC Flow Logs, DNS Logs, and CloudTrail events. Apply machine learning algorithms and anomaly detections to discover threats
* Can protect against CryptoCurrency attacks

### Amazon Inspector

* Automated Security Assessment service for **EC2 instances** by installing an agent in the OS of EC2 instance.
* Inspector comes with pre-defined rules packages:
  * `Network Reachability` rules package checks for unintended network accessibility of EC2 instances
  * `Host Assessment rules` package checks for vulnerabilities and insecure configurations on EC2 instance. Includes Common Vulnerabilities and Exposures (CVE), Center for Internet Security (CIS) Operating System configuration benchmarks, and security best practices.

### Amazon Macie

* Managed service to discover and protect your **sensitive data** in AWS
* Macie identify and alert for sensitive data, such as **Personally Identifiable Information (PII)** in your selected S3 buckets

### AWS Config

* Managed service to assess, audit, and evaluate configurations of your AWS resources in multi-region, multi-account
* You are notified via SNS for any configuration change
* Integrated with CloudTrail, provide resource configuration history
* Use case: Customers need to comply with standards like PCI-DSS (Payment Card Industry Data Security Standard) or HIPAA (U.S. Health Insurance Portability and Accountability Act) can use this service to assess compliance of AWS infra configurations

## Compute

### EC2

## Autoscaling

bla

## AWS Organization and Control Tower


## VPC


## S3


## DNS, Catching and Performance

## Block and File Storage

## Docker Container and ECS

## Serveless Applications


## Databases y Analytics

## Deployment and Management

## Monitoring, Loggin and Auditing

## Security in the Cloud

## Migration and Trasnfer

## Web, Mobile, ML and Cost Managemnt



